{% extends 'base.html.twig' %}

{% block body %}
<div class="container mt-5">
  <h2>My Orders</h2>

  <!-- Toggle Buttons -->
  <div class="btn-group mb-3" role="group">
    <button class="btn btn-outline-primary active" id="btn-rentals">Rentals</button>
    <button class="btn btn-outline-primary" id="btn-purchases">Purchases</button>
  </div>

  <!-- Rentals Table -->
  <div id="rentals-section" class="fade show">
    <h4>Your Rentals</h4>
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Product</th>
            <th>Start</th>
            <th>End</th>
            <th>Amount</th>
            <th>Buyout</th>
          </tr>
        </thead>
        <tbody>
          {% for rental in rentals %}
            <tr>
              <td>{{ rental.productID.name }}</td>
              <td>{{ rental.startTimestamp|date('Y-m-d') }}</td>
              <td>
                {{ rental.endTimestamp|date('Y-m-d') }}
                <button class="btn btn-sm btn-secondary extend-btn" data-rental-id="{{ rental.id }}">Wydłuż</button>
              </td>
              <td>{{ rental.amount }}</td>
              <td>{{ rental.buyoutCost }}</td>
            </tr>
            <tr class="extend-form-row d-none" id="extend-form-{{ rental.id }}">
                <td colspan="5">
                  <form class="extend-form d-flex align-items-center gap-2" data-rental-id="{{ rental.id }}">
                    <label class="form-label m-0">New end date:</label>
                    <input type="date" name="new_end_date" class="form-control" required>
                    <button class="btn btn-sm btn-primary">Confirm</button>
                  </form>
                </td>
              </tr>
          {% else %}
            <tr><td colspan="6">No rentals found.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Purchases Table -->
  <div id="purchases-section" class="fade d-none">
    <h4>Your Purchases</h4>
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Product</th>
            <th>Date</th>
            <th>Amount</th>
            <th>Quantity</th>
          </tr>
        </thead>
        <tbody>
          {% for purchase in purchases %}
            <tr>
              <td>{{ purchase.productID.name }}</td>
              <td>{{ purchase.timestamp|date('Y-m-d') }}</td>
              <td>{{ purchase.amount }}</td>
              <td>{{ purchase.quantity }}</td>
            </tr>
          {% else %}
            <tr><td colspan="4">No purchases found.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script src="{{ asset('js/my_orders.js') }}"></script>
{% endblock %}
